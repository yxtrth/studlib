<!DOCTYPE html>
<html>
<head>
    <title>MongoDB Connection Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .success { color: green; }
        .error { color: red; }
        .warning { color: orange; }
        button { padding: 10px 20px; margin: 10px; }
        pre { background: #f5f5f5; padding: 10px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>üîß MongoDB Authentication Debug Tool</h1>
    
    <div id="status"></div>
    
    <button onclick="testLocal()">Test Local Backend</button>
    <button onclick="testProduction()">Test Production Backend</button>
    <button onclick="testDirect()">Test Direct MongoDB</button>
    
    <div id="results"></div>
    
    <h2>üìã MongoDB Atlas Checklist:</h2>
    <ul>
        <li>‚úÖ Database user exists in MongoDB Atlas</li>
        <li>‚úÖ Username and password are correct</li>
        <li>‚úÖ User has "Read and write to any database" permissions</li>
        <li>‚úÖ Network access allows 0.0.0.0/0 (all IPs)</li>
        <li>‚úÖ MONGODB_URI is correctly set in Render environment</li>
        <li>‚úÖ No special characters in password (or properly URL encoded)</li>
    </ul>
    
    <script>
        const statusDiv = document.getElementById('status');
        const resultsDiv = document.getElementById('results');
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'success' ? 'green' : type === 'error' ? 'red' : 'black';
            resultsDiv.innerHTML += `<div style="color: ${color}">[${timestamp}] ${message}</div>`;
        }
        
        async function testLocal() {
            log('üîç Testing local backend connection...', 'info');
            
            try {
                const response = await fetch('http://localhost:5000/api/test');
                const data = await response.json();
                log('‚úÖ Local backend connected successfully!', 'success');
                log(`Response: ${JSON.stringify(data)}`, 'info');
            } catch (error) {
                log(`‚ùå Local backend failed: ${error.message}`, 'error');
                log('Make sure to run: cd backend && npm start', 'warning');
            }
        }
        
        async function testProduction() {
            log('üåê Testing production backend...', 'info');
            
            try {
                // Replace with your actual Render URL
                const response = await fetch('https://your-app.onrender.com/api/test');
                const data = await response.json();
                log('‚úÖ Production backend connected!', 'success');
                log(`Response: ${JSON.stringify(data)}`, 'info');
            } catch (error) {
                log(`‚ùå Production backend failed: ${error.message}`, 'error');
                log('Check Render deployment logs for MongoDB errors', 'warning');
            }
        }
        
        async function testDirect() {
            log('üîó MongoDB connection info:', 'info');
            log('Check these in your Render environment variables:', 'info');
            log('1. MONGODB_URI should start with: mongodb+srv://', 'info');
            log('2. Format: mongodb+srv://username:password@cluster.mongodb.net/database', 'info');
            log('3. No special characters in password', 'info');
            log('4. Database name matches your actual database', 'info');
            
            const sampleUri = 'mongodb+srv://studlib-user:simplepassword@cluster0.mongodb.net/student-library?retryWrites=true&w=majority';
            log(`Sample URI: ${sampleUri}`, 'info');
        }
        
        // Auto-test on load
        statusDiv.innerHTML = '<h3>üöÄ Ready to test MongoDB connections</h3>';
    </script>
</body>
</html>
